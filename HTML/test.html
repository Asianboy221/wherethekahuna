<!DOCTYPE html>
<html>

<head>
  <title>Where the Kahuna</title>
  <link rel="stylesheet" type="text/css" href="../Stylesheets/main.css">
  <link rel="icon" href="http://flaglane.com/download/american-flag/american-flag-large.gif">
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

    #map {
      height: 100%;
      width: auto;
      margin: 50px;
      margin-bottom: 0px;
      display: table-cell;
      vertical-align: middle
    }
  </style>
</head>

<body>
  <section class="gridlayout">

    <section class="upper" id="map">
      <!-- <div id="map"></div> -->
    </section>
    <section class="lower">
      <h3>This is A TEST!!!!!!</h3>
    </section>
  </section>
  <script>
    var map, infoWindow;
    var findInput = document.getElementById("find").value;
    var findInput = document.getElementById("location").value;

    function initMap() {
      // The starting location of Salt Lake City
      var startingLocation = { lat: 40.760779, lng: -111.891047 };
      // The map, centered at Salt Lake City
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: startingLocation
      });
      var request = {
        location: map.getCenter(),
        radius: 1609,
        query: 'Burgers'
      }
      infoWindow = new google.maps.InfoWindow;
      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          //Getting current location
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          //Center map over current location add marker to current location
          map.setCenter(pos);
          var icon = {
            url: "../img/usflag.png", // url
            scaledSize: new google.maps.Size(50, 50), // scaled size
            origin: new google.maps.Point(0, 0), // origin
          };
          var currentlocation = {
            url: "../img/currentlocation.png", // url
            scaledSize: new google.maps.Size(50, 50), // scaled size
            origin: new google.maps.Point(0, 0), // origin
          };
          var marker = new google.maps.Marker({
            position: pos,
            map: map,
            animation: google.maps.Animation.DROP,
            icon: currentlocation
          });

          var service = new google.maps.places.PlacesService(map);
          service.nearbySearch({
            location: pos,
            radius: 1609, //1 Mile
            keyword: ['chicken'],
            type: ['restaurant']
          }, callback);
        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }


    function callback(results, status) {
      if (status === google.maps.places.PlacesServiceStatus.OK) {
        for (var i = 0; i < results.length; i++) {
          createMarker(results[i]);
        }
      }
    }
    //Add Markers to nearby places
    function createMarker(place) {
      var placeLoc = place.geometry.location;
      var photos = place.photos;
      if (!photos) {
        return;
      }
      var icon = {
        url: "../img/locations.png", // url
        scaledSize: new google.maps.Size(50, 50), // scaled size
        origin: new google.maps.Point(0, 0), // origin
      };
      var marker = new google.maps.Marker({
        map: map,
        position: place.geometry.location,
        animation: google.maps.Animation.DROP,
        icon: photos[0].getUrl({ 'maxWidth': 35, 'maxHeight': 35 })
      });

      google.maps.event.addListener(marker, 'click', function () {
        infowindow.setContent(place.name);
        infowindow.open(map, this);
      });
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAubZQ79mLt-Yli8Mac-8I4Nl56j8Y2W3s&libraries=places&callback=initMap"
    async defer></script>
</body>

</html>